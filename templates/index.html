<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ° Han's Custom Made - ë¡œë˜ ì˜ˆì¸¡</title>
    
    <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="header-content">
            <h1>ğŸ° Han's Custom Made</h1>
            <p class="subtitle">ë¡œë˜ ë²ˆí˜¸ ì˜ˆì¸¡ ì‹œìŠ¤í…œ v2.0</p>
            <p class="latest-info">ìµœì‹  ë°ì´í„°: <strong>{{ latest_round }}íšŒì°¨</strong></p>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <main class="container">
        
        <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
        <section class="control-panel">
            <h2><i class="fas fa-sliders-h"></i> ë¶„ì„ ì„¤ì •</h2>
            <div class="control-group">
                <label for="window-select">ë¶„ì„ êµ¬ê°„ ì„ íƒ:</label>
                <select id="window-select">
                    <option value="30">ìµœê·¼ 30íšŒì°¨</option>
                    <option value="50" selected>ìµœê·¼ 50íšŒì°¨ (ê¶Œì¥)</option>
                    <option value="100">ìµœê·¼ 100íšŒì°¨</option>
                    <option value="200">ìµœê·¼ 200íšŒì°¨</option>
                </select>
                <button id="predict-btn" class="btn-primary">
                    <i class="fas fa-magic"></i> ë²ˆí˜¸ ìƒì„±
                </button>
                <button id="multi-btn" class="btn-secondary">
                    <i class="fas fa-layer-group"></i> ë‹¤ì¤‘ ë¶„ì„
                </button>
            </div>
        </section>

        <!-- ë¡œë”© ì¸ë””ì¼€ì´í„° -->
        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p>ë¶„ì„ ì¤‘...</p>
        </div>

        <!-- í’€ ì •ë³´ -->
        <section id="pool-info" class="pool-info hidden">
            <div class="info-card hot">
                <i class="fas fa-fire"></i>
                <h3>Hot Pool</h3>
                <p class="count" id="hot-count">0</p>
                <span>2íšŒ ì´ìƒ ë“±ì¥</span>
            </div>
            <div class="info-card cold">
                <i class="fas fa-snowflake"></i>
                <h3>Cold Pool</h3>
                <p class="count" id="cold-count">0</p>
                <span>1íšŒ ì´í•˜ ë“±ì¥</span>
            </div>
        </section>

        <!-- ì˜ˆì¸¡ ê²°ê³¼ -->
        <section id="results" class="results hidden">
            <h2><i class="fas fa-star"></i> ì˜ˆì¸¡ ê²°ê³¼</h2>
            <div id="prediction-cards" class="prediction-cards">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>
        </section>

        <!-- ë¹ˆë„ ì°¨íŠ¸ -->
        <section id="chart-section" class="chart-section hidden">
            <h2><i class="fas fa-chart-bar"></i> Hot ë²ˆí˜¸ ë¹ˆë„</h2>
            <div class="chart-container">
                <canvas id="frequencyChart"></canvas>
            </div>
        </section>

        <!-- ì•Œê³ ë¦¬ì¦˜ ì„¤ëª… -->
        <section class="algorithm-info">
            <h2><i class="fas fa-info-circle"></i> ì•Œê³ ë¦¬ì¦˜ ì„¤ëª…</h2>
            <div class="algo-grid">
                <div class="algo-card" data-algo="A">
                    <span class="algo-icon">ğŸ²</span>
                    <h3>A. ëœë¤</h3>
                    <p>Hot Poolì—ì„œ ì™„ì „ ëœë¤</p>
                </div>
                <div class="algo-card" data-algo="B">
                    <span class="algo-icon">ğŸ“Š</span>
                    <h3>B. ê°€ì¤‘ì¹˜</h3>
                    <p>ë¹ˆë„ ê¸°ë°˜ í™•ë¥  ì„ íƒ</p>
                </div>
                <div class="algo-card" data-algo="C">
                    <span class="algo-icon">âš–ï¸</span>
                    <h3>C. ë°¸ëŸ°ìŠ¤</h3>
                    <p>í™€ì§ 2:4~4:2 ìœ ì§€</p>
                </div>
                <div class="algo-card" data-algo="D">
                    <span class="algo-icon">ğŸ¯</span>
                    <h3>D. í•©ê³„êµ¬ê°„</h3>
                    <p>í•©ê³„ 100~170 ë²”ìœ„</p>
                </div>
                <div class="algo-card" data-algo="E">
                    <span class="algo-icon">ğŸ”€</span>
                    <h3>E. íŒ¨í„´ë¶„ì‚°</h3>
                    <p>êµ¬ê°„ ì§‘ì¤‘ ë°©ì§€</p>
                </div>
                <div class="algo-card highlight" data-algo="F">
                    <span class="algo-icon">ğŸŒŸ</span>
                    <h3>F. AIì´ˆì •ë°€</h3>
                    <p>ëª¨ë“  ì¡°ê±´ ì¶©ì¡±</p>
                </div>
                <div class="algo-card highlight" data-algo="G">
                    <span class="algo-icon">ğŸ›¡ï¸</span>
                    <h3>G. ê³¼ì í•©ë°©ì§€</h3>
                    <p>Cold ë²ˆí˜¸ í˜¼í•©</p>
                </div>
            </div>
        </section>

    </main>

    <!-- í‘¸í„° -->
    <footer class="footer">
        <p>Â© 2024 Han's Custom Made | ë³¸ ì‹œìŠ¤í…œì€ ì°¸ê³ ìš©ì´ë©° ë‹¹ì²¨ì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
        <p>Made with â¤ï¸ by kkbhong71</p>
    </footer>

    <!-- JavaScript -->
    <script>
        // =========================================================
        // ì „ì—­ ë³€ìˆ˜
        // =========================================================
        let frequencyChart = null;

        // =========================================================
        // DOM ìš”ì†Œ
        // =========================================================
        const predictBtn = document.getElementById('predict-btn');
        const multiBtn = document.getElementById('multi-btn');
        const windowSelect = document.getElementById('window-select');
        const loading = document.getElementById('loading');
        const poolInfo = document.getElementById('pool-info');
        const results = document.getElementById('results');
        const chartSection = document.getElementById('chart-section');
        const predictionCards = document.getElementById('prediction-cards');

        // =========================================================
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        // =========================================================
        predictBtn.addEventListener('click', () => {
            const window = windowSelect.value;
            fetchPrediction(window);
        });

        multiBtn.addEventListener('click', () => {
            fetchMultiPrediction();
        });

        // =========================================================
        // API í˜¸ì¶œ í•¨ìˆ˜
        // =========================================================
        async function fetchPrediction(window) {
            showLoading(true);
            
            try {
                const response = await fetch(`/api/predict?window=${window}`);
                const result = await response.json();
                
                if (result.success) {
                    displayResults(result.data);
                } else {
                    alert('ì˜¤ë¥˜: ' + result.error);
                }
            } catch (error) {
                alert('API í˜¸ì¶œ ì‹¤íŒ¨: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function fetchMultiPrediction() {
            showLoading(true);
            
            try {
                const response = await fetch('/api/predict/multi');
                const result = await response.json();
                
                if (result.success) {
                    displayMultiResults(result.data);
                } else {
                    alert('ì˜¤ë¥˜: ' + result.error);
                }
            } catch (error) {
                alert('API í˜¸ì¶œ ì‹¤íŒ¨: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // =========================================================
        // ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
        // =========================================================
        function displayResults(data) {
            // í’€ ì •ë³´ í‘œì‹œ
            document.getElementById('hot-count').textContent = data.hot_pool_size;
            document.getElementById('cold-count').textContent = data.cold_pool_size;
            poolInfo.classList.remove('hidden');

            // ì˜ˆì¸¡ ì¹´ë“œ ìƒì„±
            predictionCards.innerHTML = '';
            
            data.predictions.forEach(pred => {
                const card = createPredictionCard(pred, data.window);
                predictionCards.appendChild(card);
            });
            
            results.classList.remove('hidden');

            // ì°¨íŠ¸ í‘œì‹œ
            displayChart(data.frequency_data);
            chartSection.classList.remove('hidden');

            // ê²°ê³¼ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            results.scrollIntoView({ behavior: 'smooth' });
        }

        function displayMultiResults(data) {
            // í’€ ì •ë³´ (ì²« ë²ˆì§¸ êµ¬ê°„ ê¸°ì¤€)
            const firstWindow = Object.keys(data)[0];
            const firstData = data[firstWindow];
            
            document.getElementById('hot-count').textContent = firstData.hot_pool_size;
            document.getElementById('cold-count').textContent = firstData.cold_pool_size;
            poolInfo.classList.remove('hidden');

            // ì˜ˆì¸¡ ì¹´ë“œ ìƒì„± (ëª¨ë“  êµ¬ê°„)
            predictionCards.innerHTML = '';
            
            for (const [window, windowData] of Object.entries(data)) {
                // êµ¬ê°„ í—¤ë”
                const header = document.createElement('div');
                header.className = 'window-header';
                header.innerHTML = `<h3>ğŸ“‚ ìµœê·¼ ${window}íšŒì°¨ ë¶„ì„</h3>`;
                predictionCards.appendChild(header);
                
                // í•´ë‹¹ êµ¬ê°„ì˜ ì˜ˆì¸¡ë“¤
                windowData.predictions.forEach(pred => {
                    const card = createPredictionCard(pred, window);
                    predictionCards.appendChild(card);
                });
            }
            
            results.classList.remove('hidden');

            // ì°¨íŠ¸ (ì²« ë²ˆì§¸ êµ¬ê°„ ê¸°ì¤€)
            displayChart(firstData.frequency_data);
            chartSection.classList.remove('hidden');

            results.scrollIntoView({ behavior: 'smooth' });
        }

        function createPredictionCard(pred, window) {
            const card = document.createElement('div');
            card.className = 'prediction-card';
            
            // íŠ¹ë³„ ì•Œê³ ë¦¬ì¦˜ ê°•ì¡°
            if (pred.code === 'F' || pred.code === 'G') {
                card.classList.add('highlight');
            }

            // ì•„ì´ì½˜ ë§¤í•‘
            const icons = {
                'A': 'ğŸ²', 'B': 'ğŸ“Š', 'C': 'âš–ï¸', 'D': 'ğŸ¯',
                'E': 'ğŸ”€', 'F': 'ğŸŒŸ', 'G': 'ğŸ›¡ï¸'
            };

            // ë²ˆí˜¸ ê³µ ìƒì„±
            const ballsHtml = pred.numbers.map((num, idx) => 
                `<span class="ball" style="background-color: ${pred.colors[idx]}">${num}</span>`
            ).join('');

            // ì¶”ê°€ ì •ë³´
            let extraInfo = '';
            if (pred.code === 'F') {
                extraInfo = `<span class="tag ac">AC: ${pred.ac_value}</span>
                             <span class="tag last">ëìˆ˜í•©: ${pred.last_digit_sum}</span>`;
            } else if (pred.code === 'G') {
                extraInfo = `<span class="tag cold">â„ï¸ Cold: ${pred.cold_count}ê°œ</span>`;
            }

            card.innerHTML = `
                <div class="card-header">
                    <span class="algo-badge">${icons[pred.code]} ${pred.code}</span>
                    <span class="algo-name">${pred.name}</span>
                </div>
                <div class="balls-container">
                    ${ballsHtml}
                </div>
                <div class="card-stats">
                    <span class="tag sum">í•©ê³„: ${pred.sum}</span>
                    <span class="tag ratio">í™€ì§: ${pred.odd_even}</span>
                    <span class="tag ratio">ê³ ì €: ${pred.high_low}</span>
                    ${extraInfo}
                </div>
                <div class="card-section">
                    <small>êµ¬ê°„ë¶„í¬: ${pred.section.join('-')}</small>
                </div>
            `;

            return card;
        }

        // =========================================================
        // ì°¨íŠ¸ í‘œì‹œ
        // =========================================================
        function displayChart(freqData) {
            const ctx = document.getElementById('frequencyChart').getContext('2d');
            
            // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
            if (frequencyChart) {
                frequencyChart.destroy();
            }

            frequencyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: freqData.numbers,
                    datasets: [{
                        label: 'ë“±ì¥ íšŸìˆ˜',
                        data: freqData.counts,
                        backgroundColor: freqData.colors,
                        borderColor: freqData.colors.map(c => c),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Hot Number Frequency',
                            font: { size: 16 }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // =========================================================
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        // =========================================================
        function showLoading(show) {
            if (show) {
                loading.classList.remove('hidden');
                results.classList.add('hidden');
                chartSection.classList.add('hidden');
            } else {
                loading.classList.add('hidden');
            }
        }

        // =========================================================
        // ì´ˆê¸° ì‹¤í–‰
        // =========================================================
        document.addEventListener('DOMContentLoaded', () => {
            // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ ì˜ˆì¸¡ ì‹¤í–‰
            fetchPrediction(50);
        });
    </script>
</body>
</html>
